extends layout

block content
  body
    .x-nav
      span.layui-breadcrumb
        a(href='') 首页
        a(href='') 演示
        a
          cite 导航元素
      a.layui-btn.layui-btn-small(style='line-height:1.6em;margin-top:3px;float:right', onclick='location.reload()', title='刷新')
        i.layui-icon.layui-icon-refresh(style='line-height:30px')
    .layui-fluid
      .layui-row.layui-col-space15
        .layui-col-md12
          .layui-card
            .layui-card-body
              form.layui-form.layui-col-space5
                .layui-input-inline.layui-show-xs-block
                  input.layui-input(placeholder='分类名', name='cate_name')
                .layui-input-inline.layui-show-xs-block
                  button.layui-btn(lay-submit='', lay-filter='sreach')
                    i.layui-icon 
                    | 增加
              hr
              blockquote.layui-elem-quote
                | 每个tr 上有两个属性 cate-id='1' 当前分类id fid='0' 父级id ,顶级分类为 0，有子分类的前面加收缩图标
                i.layui-icon.x-show(status='true') 
            .layui-card-header
              button.layui-btn.layui-btn-danger(onclick='delAll()')
                i.layui-icon 
                | 批量删除
            .layui-card-body
              table.layui-table.layui-form
                thead
                  tr
                    th(width='20')
                      input(type='checkbox', name='', lay-skin='primary')
                    th(width='70') ID
                    th 栏目名
                    th(width='50') 排序
                    th(width='80') 状态
                    th(width='250') 操作
                tbody.x-cate
                  tr(cate-id='1', fid='0')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 1
                    td
                      i.layui-icon.x-show(status='true') 
                      |                                     产品管理
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
                  tr(cate-id='2', fid='1')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 2
                    td
                      i.layui-icon.x-show(status='true') 
                      |                                     产品列表
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
                  tr(cate-id='3', fid='2')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 3
                    td
                      | ├产品列表
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
                  tr(cate-id='4', fid='2')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 4
                    td
                      | ├产品列表
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
                  tr(cate-id='5', fid='0')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 5
                    td
                      i.layui-icon.x-show(status='true') 
                      | 新闻
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
                  tr(cate-id='6', fid='5')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 6
                    td
                      | ├国内新闻
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
                  tr(cate-id='7', fid='5')
                    td
                      input(type='checkbox', name='', lay-skin='primary')
                    td 7
                    td
                      | ├国外新闻
                    td
                      input.layui-input.x-sort(type='text', name='order', value='1')
                    td
                      input(type='checkbox', name='switch', lay-text='开启|停用', checked='', lay-skin='switch')
                    td.td-manage
                      button.layui-btn.layui-btn.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 编辑
                      button.layui-btn.layui-btn-warm.layui-btn-xs(onclick="xadmin.open('编辑','admin-edit')")
                        i.layui-icon 
                        | 添加子栏目
                      button.layui-btn-danger.layui-btn.layui-btn-xs(onclick="member_del(this,'要删除的id')", href='javascript:;')
                        i.layui-icon 
                        | 删除
            .layui-card-body
              .page
                div
                  a.prev(href='') <<
                  a.num(href='') 1
                  span.current 2
                  a.num(href='') 3
                  a.num(href='') 489
                  a.next(href='') >>
    script.
      layui.use(['form'], function(){
      form = layui.form;
      });
      /*用户-删除*/
      function member_del(obj,id){
      layer.confirm('确认要删除吗？',function(index){
      //发异步删除数据
      $(obj).parents("tr").remove();
      layer.msg('已删除!',{icon:1,time:1000});
      });
      }
      // 分类展开收起的分类的逻辑
      //
      $(function(){
      $("tbody.x-cate tr[fid!='0']").hide();
      // 栏目多级显示效果
      $('.x-show').click(function () {
      if($(this).attr('status')=='true'){
      $(this)('&#xe625;');
      $(this).attr('status','false');
      cateId = $(this).parents('tr').attr('cate-id');
      $("tbody tr[fid="+cateId+"]").show();
      }else{
      cateIds = [];
      $(this)('&#xe623;');
      $(this).attr('status','true');
      cateId = $(this).parents('tr').attr('cate-id');
      getCateId(cateId);
      for (var i in cateIds) {
      $("tbody tr[cate-id="+cateIds[i]+"]").hide().find('.x-show')('&#xe623;').attr('status','true');
      }
      }
      })
      })
      var cateIds = [];
      function getCateId(cateId) {
      $("tbody tr[fid="+cateId+"]").each(function(index, el) {
      id = $(el).attr('cate-id');
      cateIds.push(id);
      getCateId(id);
      });
      }
